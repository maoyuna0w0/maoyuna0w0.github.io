#!/bin/bash
#以下为代码部分，不懂请不要乱改
#二改请标注来源
#反馈或者提供意见请加作者QQ好友
#聪明猫<1922920373>
#版本号
version=0.3
#-----------------分割线--------------------
#下面是加载头
update(){
	url=$(curl -s $target)
	url1=${url/%"[版本尾]"*/}
	url2=$(echo ${url1/*"[版本头]"/})
	url3=${url2//'<div>'/}
	url4=${url3//'</div>'/}
	url1=${url/%"[日志尾]"*/}
	url2=$(echo ${url1/*"[日志头]"/})
	url3=${url2//'<div>'/}
	url5=${url3//'</div>'/}
	url6=${url5//"[换行]"/"\n"}
if [ $url4 = $version ]
then
	echo "当前为最新版本喵！"
else
	echo "当前版本与最新版本不一致！"
	echo "当前版本:"$version
	echo "最新版本:"$url4
	echo "更新日志:"$url6
	echo "正在更新..."
	curl -s -o $sh_name1".sh" https://maoyuna0w0.github.io/1.txt
	echo "更新完成喵！请重新启动脚本喵！"
	exit
fi
}
network()
{
	 #超时时间
	 local timeout=1
	 #获取响应状态码
	 local ret_code=`curl -I -s --connect-timeout ${timeout} ${target} -w %{http_code} | tail -n1`
	if [ "x$ret_code" = "x200" ]; then
		#网络畅通
		return 1
	else
		#网络不畅通
		return 0
	fi
	return 0
}
notice(){
	echo "正在获取信息...请稍等喵"
	network
if [ $? -eq 0 ];then
	echo "获取失败喵！请检查网络后重试喵！"
	function_list_1
fi
	update
	url1=${url/%"[公告尾]"*/}
	url2=$(echo ${url1/*"[公告头]"/})
	url3=${url2//'<div>'/}
	url4=${url3//'</div>'/}
	echo ${url4//"[换行]"/"\n"}
	switch
}
switch(){
	url1=${url/%"[开关尾]"*/}
	url2=$(echo ${url1/*"[开关头]"/})
	url3=${url2//'<div>'/}
	url4=${url3//'</div>'/}
if [ $url4 = "关" ]
then
	echo "本脚本暂时停止运行喵！"
	exit
else
	echo "欢迎使用本脚本！"
fi
	function_list_1
}
#--------------分割线-----------------
#下面是功能列表
function_list_1(){
	echo "功能列表:"
	echo "1.批量修改文件名"
	echo "2.批量修改文件内文本"
	echo "3.生成QQ昵称后缀(效果：别人@你后输入的文字会出现在两个文本的中间)"
	echo "请选择功能[1-3]"
	read function_number
	function_list_2
}
function_list_2(){
if [ $function_number = 1 ]
then
	echo "输入你想修改的原文件后缀（为空则直接在所有文件后面添加后缀）"
	read data_1
	echo "输入你想修改的后缀（为空则删除上一个输入的后缀）"
	read data_2
	function_1
elif [ $function_number = 2 ]
then
	echo "输入你想修改的文件名或后缀（为空则为所有文件）"
	read data_1
	echo "输入你想替换的原文本（不能为空）"
	read data_2
	echo "输入你想替换后的文本（为空则为删除）"
	read data_3
	function_1
elif [ $function_number = 3 ]
then
	echo "请输入你要的名字前缀(例如:聪明猫)"
	read name1
	echo "请输入你要的名字后缀[注意！！请反着输入！](例如~喵，发出来就是'喵~'！)"
	read name2
	function_2
else
	echo "你这选了个什么喵！"
	exit
fi
	function_end
}
#---------------分割线-------------------
#下面是具体功能
function_1(){
if [ $data_1 ] || [ $data_2 ] || [ $data_3 ]
then
	echo "正在修改喵..."
	for file in `ls *$data_1`
	do
		if [ $function_number = 1 ]
		then
		mv $file ${file%$data_1}$data_2
		elif [ $function_number = 2 ]
		then
		sed -i 's/'$data_2/$data_3'/g' "$file"
	  fi
	done
else
	echo "你玩我呢喵！这不是什么都没改吗？！"
	exit
fi
}
function_1_1(){
	if [ $data_1 = ".sh" ]
	then
	mv $sh_name1$data_2 $sh_name1".sh"
	echo "检测到可能修改了sh文件，已恢复喵！"
	elif [ $data_1 = "sh" ]
	then
	mv $sh_name2$data_2 $sh_name2"sh"
	echo "检测到可能修改了sh文件，已恢复喵！"
	elif [ $data_1 = "h" ]
	then
	mv $sh_name3$data_2 $sh_name3"h"
	echo "检测到可能修改了sh文件，已恢复喵！"
	elif [ $data_1 ]
	then
	echo "修改完成喵！"
	else
	mv $sh_name1".sh"$data_2 $sh_name1".sh"
	echo "检测到可能修改了sh文件，已恢复喵！"
	fi
}
function_1_2(){
	if [ $data_1 = ".sh" ]
	then
	sed -i 's/'$data_3/$data_2'/g' $sh_name1".sh"
	echo "检测到可能修改了sh文件，已恢复喵！"
	elif [ $data_1 = "sh" ]
	then
	sed -i 's/'$data_3/$data_2'/g' $sh_name1".sh"
	echo "检测到可能修改了sh文件，已恢复喵！"
	elif [ $data_1 = "h" ]
	then
	sed -i 's/'$data_3/$data_2'/g' $sh_name1".sh"
	echo "检测到可能修改了sh文件，已恢复喵！"
	elif [ $data_1 ]
	then
	echo "修改完成喵！"
	else
	sed -i 's/'$data_3/$data_2'/g' $sh_name1".sh"
	echo "检测到可能修改了sh文件，已恢复喵！"
	fi
}
function_2(){
	touch 昵称.txt
	echo $name2 > 昵称.txt
	name3=$(awk '{array[NR]=$0} END { for(i=NR;i>0;i--){print array[i];} }' 昵称.txt)
	name4=$name1"⁧"$name3"⁧‭"
	echo $name4 > 昵称.txt
	echo "生成完成！请退出脚本后查看<昵称.txt>！"
	echo "可直接全选复制后设置成自己的QQ昵称！"
	exit
}
function_end(){
if [ $function_number = 1 ]
then
	function_1_1
elif [ $function_number = 2 ]
then
	function_1_2
fi
}
#-----------------分割线-------------------
#开始脚本
target="https://sharechain.qq.com/36e88405300762a1fcdf52f399b818c9"
sh_name1=$(basename "$0" .sh)
sh_name2=$(basename "$0" sh)
sh_name3=$(basename "$0" h)
notice